<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson: Declaration Merging - TypeScript Learning Path</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#8b5cf6',
                        accent: '#06b6d4',
                    }
                }
            }
        }
    </script>
    <style>
        .code-block { @apply bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto font-mono text-sm; }
        .keyword { @apply text-purple-400; }
        .type { @apply text-yellow-400; }
        .string { @apply text-green-400; }
        .comment { @apply text-gray-500; }
        .function { @apply text-blue-400; }
        .progress-bar { @apply h-2 bg-gray-200 rounded-full overflow-hidden; }
        .progress-fill { @apply h-full bg-gradient-to-r from-primary to-accent transition-all duration-500; }
        .lesson-nav { @apply flex items-center justify-between p-4 bg-white rounded-lg shadow-sm border border-gray-200; }
        .nav-btn { @apply px-4 py-2 rounded-lg font-medium transition-colors; }
        .nav-btn:hover { @apply bg-gray-100; }
        .nav-btn:disabled { @apply opacity-50 cursor-not-allowed; }
        .nav-btn.primary { @apply bg-primary text-white hover:bg-blue-600; }
        .quiz-option { @apply p-3 border-2 rounded-lg cursor-pointer transition-all hover:border-primary hover:bg-blue-50; }
        .quiz-option.selected { @apply border-primary bg-blue-50; }
        .quiz-option.correct { @apply border-green-500 bg-green-50; }
        .quiz-option.incorrect { @apply border-red-500 bg-red-50; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">
    <!-- Progress Bar -->
    <div class="fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700">Modul 8: Modules dan Namespaces</span>
                <span class="text-sm font-medium text-gray-700" id="progress-text">Lesson 7 of 7</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 100%"></div>
            </div>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-4 py-8 mt-16">
        <!-- Lesson Header -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <div class="flex items-center gap-3 mb-4">
                <span class="bg-primary text-white px-3 py-1 rounded-full text-sm font-medium">Modul 8</span>
                <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm font-medium">Lesson 7</span>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-4">Declaration Merging</h1>
            <p class="text-gray-600 leading-relaxed mb-6">
                <strong>Declaration merging</strong> adalah fitur TypeScript yang memungkinkan beberapa deklarasi dengan nama yang sama digabung menjadi satu deklarasi tunggal. Fitur ini sangat berguna untuk meng-extend types dari library eksternal, interface, namespaces, dan ambient declarations.
            </p>
            <div class="flex items-center gap-4 text-sm text-gray-500">
                <span>‚è±Ô∏è 20 menit</span>
                <span>üìä Kesulitan: Lanjutan</span>
                <span>üìö Tipe: Advanced TypeScript</span>
            </div>
        </div>

        <!-- Tujuan Pembelajaran -->
        <section class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span class="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">üéØ</span>
                Tujuan Pembelajaran
            </h2>
            <ul class="space-y-3 text-gray-700">
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Memahami konsep <strong>declaration merging</strong> dan mechanism-nya</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Meng-extend interface dengan multiple declarations</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Meng-extend namespace dengan namespace merging</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Memahami <strong>module augmentation</strong> untuk menambahkan properties ke existing types</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Meng-extend class dengan mixin pattern via declaration merging</span>
                </li>
                <li class="flex items-start gap-3">
                    <span class="text-green-500 mt-1">‚úì</span>
                    <span>Mengetahui use cases dan best practices untuk declaration merging</span>
                </li>
            </ul>
        </section>

        <!-- Konten Utama -->
        <section class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Apa itu Declaration Merging?</h2>
            
            <p class="text-gray-700 leading-relaxed mb-6">
                <strong>Declaration merging</strong> adalah proses di mana TypeScript menggabungkan beberapa deklarasi dengan nama yang sama menjadi satu deklarasi tunggal. Ketika compiler menemukan dua atau lebih deklarasi dengan identifier yang sama, ia akan <strong>merge</strong> anggota (properties, methods, types) dari semua deklarasi tersebut menjadi satu.
            </p>

            <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg">
                <h3 class="font-bold text-blue-900 mb-2">üîë Aturan Dasar Merging:</h3>
                <ul class="list-disc list-inside text-blue-800 space-y-2">
                    <li>Hanya certain constructs yang bisa di-merge: <strong>interface</strong>, <strong>namespace</strong>, <strong>type</strong> (sebagian), <strong>enum</strong>, <strong>function</strong> (overload)</li>
                    <li>Merging dilakukan pada <strong>compile-time</strong> oleh TypeScript compiler</li>
                    <li>Hasil merge adalah union dari semua anggota dari semua deklarasi</li>
                    <li>Untuk <strong>non-function members</strong>, jika ada conflict, tipe harus <strong>compatible</strong> (subtype relationship)</li>
                    <li>Untuk <strong>functions</strong>, akan menjadi <strong>overload signatures</strong></li>
                </ul>
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-8">Interface Merging</h2>

            <p class="text-gray-700 leading-relaxed mb-6">
                Interface adalah constructs yang paling sering di-merge. Ketika dua interface dengan nama yang sama didefinisikan, TypeScript akan menggabungkan semua properties dan methods menjadi satu interface.
            </p>

            <h3 class="text-xl font-bold text-gray-900 mb-4">Contoh Dasar: Interface Merging</h3>

            <div class="code-block mb-6">
<span class="comment">// File: user.base.ts</span>
<span class="keyword">interface</span> <span class="function">User</span> {
    id: <span class="type">number</span>;
    name: <span class="type">string</span>;
    email: <span class="type">string</span>;
}

<span class="comment">// File: user.roles.ts</span>
<span class="keyword">interface</span> <span class="function">User</span> {
    role: <span class="type">string</span>;
    permissions: <span class="type">string</span>[];
}

<span class="comment">// File: user.profile.ts</span>
<span class="keyword">interface</span> <span class="function">User</span> {
    profile?: {
        avatarUrl: <span class="type">string</span>;
        bio: <span class="type">string</span>;
    };
}

<span class="comment">// File: app.ts</span>
<span class="keyword">const</span> user: User = {
    id: <span class="string">1</span>,
    name: <span class="string">'John Doe'</span>,
    email: <span class="string">'john@example.com'</span>,
    role: <span class="string">'admin'</span>,
    permissions: [<span class="string">'read'</span>, <span class="string">'write'</span>],
    profile: {
        avatarUrl: <span class="string">'https://...'</span>,
        bio: <span class="string">'Developer'</span>
    }
};
<span class="comment">// TypeScript tahu semua properties dari ketiga interface!</span>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-6 mb-8 rounded-r-lg">
                <h3 class="font-bold text-green-900 mb-2">‚úÖ Use Case: Plugin/Extension Systems</h3>
                <p class="text-green-800">
                    Declaration merging sangat berguna untuk systems yang memungkinkan multiple parties menambahkan properties ke existing type. Contoh: plugin system di framework, extensible configuration objects, atau library dengan optional addons.
                </p>
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-8">Namespace Merging</h2>
            
            <p class="text-gray-700 leading-relaxed mb-6">
                Namespace juga bisa di-merge. Ketika dua namespace dengan nama yang sama didefinisikan, isi mereka digabung menjadi satu namespace. Ini memungkinkan modularisasi namespace across files.
            </p>

            <div class="code-block mb-6">
<span class="comment">// File: db.connection.ts</span>
<span class="keyword">namespace</span> <span class="function">Database</span> {
    <span class="keyword">export class</span> <span class="function">Connection</span> {
        <span class="function">connect</span>(url: <span class="type">string</span>): <span class="type">void</span> { ... }
        <span class="function">disconnect</span>(): <span class="type">void</span> { ... }
    }
}

<span class="comment">// File: db.query.ts</span>
<span class="keyword">namespace</span> <span class="function">Database</span> {
    <span class="keyword">export class</span> <span class="function">QueryBuilder</span> {
        <span class="function">select</span>(columns: <span class="type">string</span>[]): <span class="keyword">this</span> { ... }
        <span class="function">where</span>(condition: <span class="type">string</span>): <span class="keyword">this</span> { ... }
    }
}

<span class="comment">// File: app.ts</span>
<span class="keyword">import</span> { Database } <span class="keyword">from</span> <span class="string">'./db.connection'</span>;  <span class="comment">// Import dari salah satu file</span>

<span class="keyword">const</span> conn = <span class="keyword">new</span> Database.<span class="function">Connection</span>();
<span class="keyword">const</span> query = <span class="keyword">new</span> Database.<span class="function">QueryBuilder</span>();
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-8">Module Augmentation (Extending Existing Modules)</h2>
            
            <p class="text-gray-700 leading-relaxed mb-6">
                <strong>Module augmentation</strong> adalah bentuk declaration merging yang khusus digunakan untuk <strong>menambahkan</strong> properties atau methods ke module yang sudah ada (terutama module dari DefinitelyTyped atau library). Sintaksnya menggunakan <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">declare module 'module-name'</code>.
            </p>

            <h3 class="text-xl font-bold text-gray-900 mb-4">Contoh: Extending Express Request</h3>

            <div class="code-block mb-6">
<span class="comment">// File: express-augmentation.d.ts</span>
<span class="keyword">import</span> <span class="string">'express'</span>;

<span class="keyword">declare module</span> <span class="string">'express'</span> {
    <span class="keyword">export interface</span> <span class="function">Request</span> {
        user?: {
            id: <span class="type">number</span>;
            email: <span class="type">string</span>;
            role: <span class="type">string</span>;
        };
        requestId?: <span class="type">string</span>;
    }
}

<span class="comment">// File: app.ts (Express app)</span>
<span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span>;

<span class="keyword">const</span> app = <span class="function">express</span>();

app.<span class="function">get</span>(<span class="string">'/profile'</span>, (req, res) => {
    <span class="comment">// TypeScript tahu req.user sekarang!</span>
    <span class="keyword">if</span> (req.user) {
        res.<span class="function">send</span>(<span class="string">`Hello <span class="string">${req.user.email}</span>`</span>);
    }
});
            </div>

            <h3 class="text-xl font-bold text-gray-900 mb-4">Meng-extend Library Types dengan Namespace</h3>

            <div class="code-block mb-6">
<span class="comment">// File: lodash-augmentation.d.ts</span>
<span class="keyword">import</span> <span class="string">'lodash'</span>;

<span class="keyword">declare module</span> <span class="string">'lodash'</span> {
    <span class="keyword">export function</span> <span class="function">customMethod</span>(value: <span class="type">any</span>): <span class="type">boolean</span>;
}

<span class="comment">// File: app.ts</span>
<span class="keyword">import</span> { customMethod } <span class="keyword">from</span> <span class="string">'lodash'</span>;

<span class="function">customMethod</span>(<span class="string">'test'</span>);  <span class="comment">// TypeScript tahu customMethod!</span>
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-8">Function Overload Merging</h2>
            
            <p class="text-gray-700 leading-relaxed mb-6">
                Function declarations juga bisa di-merge untuk membuat <strong>overload signatures</strong>. Setiap deklarasi function dengan nama yang sama akan menjadi overload signature.
            </p>

            <div class="code-block mb-6">
<span class="comment">// File: utils.ts</span>
<span class="keyword">function</span> <span class="function">format</span>(value: <span class="type">string</span>): <span class="type">string</span>;
<span class="keyword">function</span> <span class="function">format</span>(value: <span class="type">number</span>): <span class="type">string</span>;
<span class="keyword">function</span> <span class="function">format</span>(value: <span class="type">boolean</span>): <span class="type">string</span>;
<span class="keyword">function</span> <span class="function">format</span>(value: <span class="type">any</span>): <span class="type">string</span> {
    <span class="keyword">return</span> <span class="function">String</span>(value);
}

<span class="comment">// File: app.ts</span>
<span class="function">format</span>(<span class="string">'hello'</span>);  <span class="comment">// OK, return string</span>
<span class="function">format</span>(<span class="string">123</span>);    <span class="comment">// OK, return string</span>
<span class="function">format</span>(<span class="keyword">true</span>);      <span class="comment">// OK, return string</span>
            </div>

            <h2 class="text-2xl font-bold text-gray-900 mb-6 mt-8">Pitfalls dan Best Practices</h2>

            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <h3 class="font-bold text-red-900 mb-3">‚ö†Ô∏è Pitfalls</h3>
                    <ul class="list-disc list-inside text-red-800 space-y-2 text-sm">
                        <li><strong>Implicit any</strong>: Merging bisa menyembunyikan missing types</li>
                        <li><strong>Circular dependencies</strong>: Merging antar files bisa circular</li>
                        <li><strong>Namespace pollution</strong>: Terlalu banyak merging bikin sulit track</li>
                        <li><strong>Non-function conflict</strong>: Property types harus compatible, atau error</li>
                        <li><strong>Order matters</strong>: Implementation harus setelah semua declarations</li>
                    </ul>
                </div>

                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                    <h3 class="font-bold text-green-900 mb-3">‚úÖ Best Practices</h3>
                    <ul class="list-disc list-inside text-green-800 space-y-2 text-sm">
                        <li>Gunakan untuk <strong>extending third-party types</strong> (Express, Vue, dll)</li>
                        <li>Buat file <code class="bg-green-100 px-2 py-1 rounded text-sm font-mono">.d.ts</code> terpisah untuk augmentation</li>
                        <li>Pastikan <strong>import statements</strong> di augmentation file benar</li>
                        <li>Hanya tambah properties yang <strong>optional</strong> untuk compatibility</li>
                        <li>Dokumentasikan merged interface dengan comment</li>
                        <li>Hindari merging untuk core types yang tidak perlu di-extend</li>
                    </ul>
                </div>
            </div>

            <div class="bg-purple-50 border-l-4 border-purple-500 p-6 mb-8 rounded-r-lg">
                <h3 class="font-bold text-purple-900 mb-2">üí° When to Use Declaration Merging:</h3>
                <ul class="list-disc list-inside text-purple-800 space-y-2">
                    <li><strong>Extending framework types</strong> (Express Request/Response, React props, Vue component options)</li>
                    <li><strong>Plugin architectures</strong> di mana plugin bisa menambahkan properties ke core types</li>
                    <li><strong>Global augmentation</strong> untuk adding global variables/functions</li>
                    <li><strong>Monkey-patching</strong> library dengan methods tambahan</li>
                </ul>
                <p class="text-purple-800 mt-3">
                    <strong>Avoid</strong> declaration merging untuk regular application types - gunakan <strong>interface extension</strong> (<code class="bg-purple-100 px-2 py-1 rounded text-sm font-mono">interface A extends B</code>) atau <strong>type composition</strong> (<code class="bg-purple-100 px-2 py-1 rounded text-sm font-mono">type C = A & B</code>) yang lebih eksplisit.
                </p>
            </div>
        </section>

        <!-- Latihan Praktis -->
        <section class="bg-white rounded-2xl shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span class="bg-green-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">üíª</span>
                Latihan Praktis
            </h2>

            <div class="space-y-6">
                <div class="border-l-4 border-green-500 pl-6">
                    <h3 class="font-bold text-gray-900 mb-2">Latihan 1: Interface Merging untuk Config</h3>
                    <p class="text-gray-700 mb-4">
                        Anda memiliki module konfigurasi yang didefinisikan di multiple files:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mb-4">
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">config.database.ts</code>: interface <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">AppConfig</code> dengan <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">db: { host, port, username, password }</code></li>
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">config.server.ts</code>: interface <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">AppConfig</code> dengan <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">port, host, env</code></li>
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">config.cache.ts</code>: interface <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">AppConfig</code> dengan <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">cache: { enabled, ttl }</code></li>
                    </ul>
                    <p class="text-gray-700">
                        Pastikan semua properties ter-merge dengan benar. Buat object <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">config: AppConfig</code> dengan semua fields.
                    </p>
                </div>

                <div class="border-l-4 border-blue-500 pl-6">
                    <h3 class="font-bold text-gray-900 mb-2">Latihan 2: Module Augmentation untuk Express</h3>
                    <p class="text-gray-700 mb-4">
                        Extend Express <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">Request</code> interface dengan property <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">currentUser</code> yang berisi:
                    </p>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 mb-4">
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">id: number</code></li>
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">email: string</code></li>
                        <li><code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">roles: string[]</code></li>
                    </ul>
                    <p class="text-gray-700">
                        Buat file <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">express-augmentation.d.ts</code> dan gunakan di route handler.
                    </p>
                </div>

                <div class="border-l-4 border-purple-500 pl-6">
                    <h3 class="font-bold text-gray-900 mb-2">Latihan 3: Namespace + Interface Merging</h3>
                    <p class="text-gray-700 mb-4">
                        Buat namespace <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">API</code> dengan interface <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">Response</code> di file pertama (properties: <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">status: number</code>, <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">data: any</code>). Di file kedua, merge interface <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">Response</code> dengan tambahan <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">headers: Record&lt;string, string&gt;</code>. Di file ketiga, tambah namespace <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">API.Errors</code> dengan class <code class="bg-gray-100 px-2 py-1 rounded text-sm font-mono">APIError</code>.
                    </p>
                </div>
            </div>
        </section>

        <!-- Navigasi Lesson -->
        <div class="lesson-nav">
            <button class="nav-btn" onclick="alert('Navigate to previous lesson (Module 8, Lesson 6)')">
                ‚Üê Sebelumnya: Namespaces
            </button>
            <div class="flex items-center gap-4">
                <button class="nav-btn" onclick="alert('Feature coming soon: Bookmark')">
                    üîñ Bookmark
                </button>
                <button class="nav-btn primary" onclick="alert('Feature coming soon: Mark as Complete')">
                    ‚úì Selesai
                </button>
            </div>
            <button class="nav-btn primary" onclick="alert('Module 8 Complete! Next: Module 9 - Configuration Tooling')">
                Modul 8 Selesai ‚Üí Module 9
            </button>
        </div>
    </main>

    <!-- Quiz Section -->
    <section class="max-w-4xl mx-auto px-4 pb-12">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <span class="bg-secondary text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">‚ùì</span>
                Quiz: Declaration Merging
            </h2>
            <div id="quiz-container" class="space-y-6">
                <p class="text-gray-600">Memuat quiz...</p>
            </div>
        </div>
    </section>

    <script src="/typescript-learning-path/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof loadQuiz === 'function') {
                loadQuiz('module8', 'declaration-merging');
            }
        });
    </script>
</body>
</html>